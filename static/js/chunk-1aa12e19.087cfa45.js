(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1aa12e19"],{9806:function(e,t,s){"use strict";s("f9d6")},d840:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"orderConfirm"},[s("div",{staticClass:"header"},[s("van-sticky",[s("van-nav-bar",{attrs:{title:"订单确认","left-text":"返回","left-arrow":""},on:{"click-left":function(t){return e.$router.go(-1)}}})],1)],1),s("div",{staticClass:"address",on:{click:e.showAddress}},[s("div",[s("div",{staticStyle:{color:"#323233"}},[s("van-icon",{attrs:{name:"location-o",size:"16"}}),s("span",{staticStyle:{"margin-left":"5px"}},[e._v("服务地址")])],1),s("div",{staticStyle:{color:"#969799","font-size":"14px"}},[s("span",{staticStyle:{"margin-right":"10px"}},[e._v("姓名："+e._s(e.selectAddress.name))]),s("span",[e._v("电话："+e._s(e.selectAddress.tel))]),s("div",[s("span",[e._v("地址："+e._s(e.selectAddress.address))])])])])]),s("div",{staticClass:"orderDetail"},[s("div",[s("div",{staticStyle:{color:"#323233"}},[s("van-icon",{attrs:{name:"orders-o",size:"16"}}),s("span",{staticStyle:{"margin-left":"5px"}},[e._v("订单详情")]),s("div",{staticClass:"detailProject",staticStyle:{color:"#969799","font-size":"14px"}},[e._l(e.orderLines.values(),(function(t){return s("van-row",{key:t.productId},[s("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[s("span",[e._v(e._s(t.productName))]),s("span",[e._v("￥"+e._s(t.price))]),s("span",[e._v("x"+e._s(t.number))])])])})),s("van-divider"),s("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[s("span",[e._v("总价：")]),s("span",[e._v("￥"+e._s(e.total))])])],2)],1)])]),s("div",{staticClass:"serviceTime",on:{click:function(t){e.showTime=!0}}},[s("div",[s("div",{staticStyle:{color:"#323233"}},[s("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[s("div",[s("van-icon",{attrs:{name:"aim",size:"12"}}),s("span",{staticStyle:{"margin-left":"5px"}},[e._v("服务时间")])],1),s("div",[s("span",{staticStyle:{color:"#969799","font-size":"14px"}},[e._v(e._s(e.currentDate))])])])])])]),s("div",{staticClass:"submit"},[s("div",{staticClass:"submitBtn",on:{click:e.showPasswordInput}},[e._v("确认提交")])]),s("van-action-sheet",{attrs:{title:"选择地址"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("div",{staticClass:"content"},[s("van-address-list",{attrs:{list:e.addressList,"add-button-text":"确定","default-tag-text":"默认"},on:{"click-item":e.select,add:e.onConfirm,edit:e.onEdit},model:{value:e.chosenAddressId,callback:function(t){e.chosenAddressId=t},expression:"chosenAddressId"}})],1)]),s("van-action-sheet",{attrs:{title:"修改地址"},model:{value:e.editAddress,callback:function(t){e.editAddress=t},expression:"editAddress"}},[s("van-form",{ref:"form",on:{submit:e.onSubmitEditForm}},[s("van-field",{attrs:{name:"username",label:"姓名",placeholder:"姓名",rules:[{required:!0,message:"请填写姓名"}]},model:{value:e.editFormNow.name,callback:function(t){e.$set(e.editFormNow,"name",t)},expression:"editFormNow.name"}}),s("van-field",{attrs:{name:"telephone",label:"电话",placeholder:"电话",rules:[{required:!0,message:"请填写电话"}]},model:{value:e.editFormNow.tel,callback:function(t){e.$set(e.editFormNow,"tel",t)},expression:"editFormNow.tel"}}),s("van-field",{attrs:{readonly:"",clickable:"",name:"area",value:e.addressStr,label:"地区选择",placeholder:"点击选择省市区"},on:{click:function(t){e.showArea=!0}}}),s("van-popup",{attrs:{position:"bottom"},model:{value:e.showArea,callback:function(t){e.showArea=t},expression:"showArea"}},[s("van-area",{attrs:{"area-list":e.areaList},on:{confirm:e.onConfirmAddress,cancel:e.onCancel}})],1),s("van-field",{attrs:{name:"address",label:"详细地址",placeholder:"详细地址",rules:[{required:!0,message:"请填写详细地址"}]},model:{value:e.addressDetail,callback:function(t){e.addressDetail=t},expression:"addressDetail"}}),s("div",{staticStyle:{margin:"16px"}},[s("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("提交")])],1)],1)],1),s("van-action-sheet",{attrs:{title:"选择服务时间"},model:{value:e.showTime,callback:function(t){e.showTime=t},expression:"showTime"}},[s("van-datetime-picker",{attrs:{type:"datetime",title:"","min-date":e.minDate,"max-date":e.maxDate,formatter:e.formatter},on:{confirm:e.Change,cancel:function(t){e.showTime=!1},change:e.Change},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1),s("van-popup",{style:{width:"90%",height:"50%"},model:{value:e.showPop,callback:function(t){e.showPop=t},expression:"showPop"}},[s("van-password-input",{attrs:{value:e.value,focused:e.showKeyboard,info:"密码为 6 位数字","error-info":e.errorInfo},on:{focus:function(t){e.showKeyboard=!0}}}),s("van-number-keyboard",{attrs:{show:e.showKeyboard},on:{blur:function(t){e.showKeyboard=!1}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),s("div",{staticStyle:{height:"80px"}})],1)},a=[],i=s("6b75");function n(e){if(Array.isArray(e))return Object(i["a"])(e)}s("a4d3"),s("e01a"),s("d3b7"),s("d28b"),s("3ca3"),s("ddb0"),s("a630");function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var d=s("06c5");function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e){return n(e)||o(e)||Object(d["a"])(e)||c()}var u=s("1da1"),h=s("b85c"),m=s("5530"),f=(s("96cf"),s("a15b"),s("d81d"),s("4de4"),s("b0c0"),s("fb6a"),s("159b"),s("9163")),p=s("2f62"),v=s("dac6"),b={data:function(){return{show:!1,chosenAddressId:0,addressList:[],selectAddress:{},showTime:!1,currentDate:new Date,minDate:new Date,maxDate:new Date(2021,12,1),timestamp:"",line:[],message:"",value:"",showKeyboard:!0,showPop:!1,errorInfo:"",editAddress:!1,eidtSubForm:{province:"",city:"",area:"",address:"",username:"",telephone:"",id:"",userId:""},editFormNow:{},addressStr:"",showArea:!1,areaList:f["areaList"],province:"",city:"",area:"",addressDetail:"",formId:""}},created:function(){this.getAllAddress(),this.queryUser(),this.Change(),this.changeTimeToChuo(),this.orderLineChange()},computed:Object(m["a"])(Object(m["a"])(Object(m["a"])({},Object(p["e"])("user",["userInfo"])),Object(p["e"])("shopcart",["orderLines"])),Object(p["c"])("shopcart",["total"])),watch:{value:function(e){6===e.length&&e!==this.userInfo.password?this.errorInfo="密码错误":6===e.length&&e==this.userInfo.password&&(this.errorInfo="",this.submitOrder())}},methods:Object(m["a"])(Object(m["a"])(Object(m["a"])({},Object(p["b"])("user",["getUserInfo"])),Object(p["d"])("shopcart",["addShopcart","clearShopcart"])),{},{orderLineChange:function(){var e,t=Object(h["a"])(this.orderLines.values());try{for(t.s();!(e=t.n()).done;){var s=e.value;this.line.push(s)}}catch(r){t.e(r)}finally{t.f()}},onCancel:function(){this.showArea=!1},onConfirm:function(e){this.show=!1},showPasswordInput:function(){var e=this;this.$dialog.alert({title:"支付金额",message:"￥"+this.total,theme:"round-button"}).then(Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.showPop=!0;case 1:case"end":return t.stop()}}),t)}))))},submitOrder:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var s,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=l(e.line),delete s[0].productName,s[0].id=0,s[0].orderId=0,r={addressId:e.chosenAddressId,customerId:e.userInfo.id,orderLines:s,serviceTime:e.timestamp},t.next=7,Object(v["d"])("/order/submitOrder",r);case 7:a=t.sent,200==a.status&&(e.showPop=!1,e.$toast.success("支付成功!"),e.$router.push({path:"/manager/order"}));case 9:case"end":return t.stop()}}),t)})))()},changeTimeToChuo:function(){var e=new Date(this.currentDate);this.timestamp=e.getTime()},Change:function(){this.showTime=!1;var e=this.currentDate,t="-",s=":",r=e.getMonth()+1,a=e.getDate(),i=e.getHours(),n=e.getMinutes()>9?e.getMinutes():"0"+e.getMinutes();r>=1&&r<=9&&(r="0"+r),a>=0&&a<=9&&(a="0"+a),i>=0&&i<=9&&(i="0"+i),this.currentDate=e.getFullYear()+t+r+t+a+" "+i+s+n+s+"00"},formatter:function(e,t){return"year"===e?t+"年":"month"===e?t+"月":"day"===e?t+"日":"hour"===e?t+"时":"minute"===e?t+"分":t},select:function(e){this.selectAddress=e},onConfirmAddress:function(e){this.addressStr=e.filter((function(e){return!!e})).map((function(e){return e.name})).join("-"),this.province=e[0].name,this.city=e[1].name,this.area=e[2].name,this.showArea=!1},onEdit:function(e,t){this.formId=e.id,this.editFormNow=e;var s=0,r=this.editFormNow.address.indexOf("省"),a=0;-1==r?(s=this.editFormNow.address.indexOf("自治区"),-1!=s?this.province=this.editFormNow.address.slice(0,s+3):(this.province=this.editFormNow.address.slice(0,3),a=1)):this.province=this.editFormNow.address.slice(0,r+1);var i=this.editFormNow.address.indexOf("市");1==a?(this.city=this.editFormNow.address.slice(0,3),i=5):this.city=0==s?this.editFormNow.address.slice(r+1,i+1):this.editFormNow.address.slice(s+3,i+1);var n=e.address.slice(i+1);a=n.indexOf("区");-1==a?(a=n.indexOf("县"),this.area=n.slice(0,a+1)):(this.area=n.slice(0,a+1),this.addressDetail=n.slice(a+1)),this.editAddress=!0,this.addressStr=this.province+"-"+this.city+"-"+this.area},onSubmitEditForm:function(e){var t=this;this.eidtSubForm.id=this.formId,this.eidtSubForm.userId=this.userInfo.id,this.eidtSubForm.username=e.username,this.eidtSubForm.telephone=e.telephone,this.eidtSubForm.province=this.province,this.eidtSubForm.area=this.area,this.eidtSubForm.city=this.city,this.eidtSubForm.address=e.address,this.$refs.form.validate().then(Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(v["b"])("/address/saveOrUpdate",t.eidtSubForm);case 2:e.sent,t.addressList=[],t.getAllAddress(),t.$toast.success("修改成功");case 6:case"end":return e.stop()}}),e)})))).catch((function(){t.$toast.fail("修改失败")})),this.editAddress=!1},getAllAddress:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var s,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s={page:1,pageSize:100,userId:e.userInfo.id},t.next=3,Object(v["a"])("/address/pageQuery",s);case 3:if(r=t.sent,a=r.data.data.list,a){t.next=7;break}return t.abrupt("return");case 7:a.forEach((function(t,s){var r={};r.id=t.id,r.name=t.username,r.tel=t.telephone,e.detailAddress=t.address,r.address=t.province+t.city+t.area+t.address,2300==r.id?r.isDefault=!0:r.isDefault=t.isDefault,e.addressList.push(r),e.chosenAddressId=e.addressList[0].id,e.selectAddress=e.addressList[0]}));case 8:case"end":return t.stop()}}),t)})))()},queryUser:function(){this.getUserInfo()},showAddress:function(){this.show=!0}})},w=b,y=(s("9806"),s("2877")),g=Object(y["a"])(w,r,a,!1,null,"fa078a8a",null);t["default"]=g.exports},f9d6:function(e,t,s){}}]);
//# sourceMappingURL=chunk-1aa12e19.087cfa45.js.map